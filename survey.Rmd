---
title: "Survey cleaning"
author: "Rick Gilmore"
date: "`r Sys.Date()`"
bibliography: bib/psu-repro.bib
csl: bib/apa.csl
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      fig.path = "img/")
```

## Purpose

This document summarizes the data downloading and cleaning involved in the informal survey of NYU Steinhardt graduate students collected in January and February of 2023.

The survey can be found here:

<https://forms.gle/tq8QWq94Ru9M4sfJ9>

## Background {-}

Some of survey questions were derived from the Appendix in [[@Kardash2012-kq]](https://doi.org/10.1007/s11251-011-9195-0).
We thank these authors for publishing the survey questions in their article so that they could be reused.

Rick Gilmore used these for his [class](https://psu-psychology.github.io/psych-490-reproducibility-2023-spring-notes/survey_01_results.html) in the Spring term of 2023.

Questions about the reproducibility crisis are from [[@baker_1500_2016]](http://www.nature.com/news/1-500-scientists-lift-the-lid-on-reproducibility-1.19970).

## Set-up {-}

```{r set-up-survey-results, include = FALSE}
# Defaults for chunks, especially figures
knitr::opts_chunk$set(echo = TRUE,
                      out.width = "75%")
```

We load the required R packages.

```{r survey-1-setup, e}
suppressPackageStartupMessages(library("tidyverse")) # for pipe %>%
suppressPackageStartupMessages(library("googledrive"))
suppressPackageStartupMessages(library("magrittr"))
suppressPackageStartupMessages(library("dplyr"))
suppressPackageStartupMessages(library("ggplot2"))
```

## Download data {-}

Download the data file from the spreadsheet generated by the Google Form into a comma-separated value (CSV) file in a local directory called `csv/`.

Authenticate to Google.

```{r}
googledrive::drive_auth(email = "rick.o.gilmore@gmail.com")
```

```{r}
if (!dir.exists('csv')) {
  dir.create('csv')
}

csv_fn <- "csv/nyu-steinhardt.csv"

googledrive::drive_download(file = 'NYU Steinhardt Survey (Responses)', path = csv_fn, type = 'csv', overwrite = TRUE)
```

## Clean data {-}

Load the data file.

```{r}
if (file.exists(csv_fn)) {
  survey <- readr::read_csv(csv_fn, show_col_types = FALSE)
} else {
  message("File not found: ", csv_fn)
  survey <- NULL
}
```

### Extract specific questions

```{r}
if (is.null(survey)) {
  warning("Error loading data file")
} else {
  names(survey)
}
```

These variable names are too long to be useful.
Let's look at the source publication [[@Kardash2012-kq]](https://doi.org/10.1007/s11251-011-9195-0) to see if we can simplify them in a useful way.

So, the Appendix labels each question with a short phrase and notes whether the concept is a norm (N) or counter-norm (CN).
Let's rename the variables using the single words.

```{r}
new_names <-
  c(
    "Timestamp",
    "heardof_reproducibility_crisis",
    "my_area_reproducibility_crisis",
    "disinterestedness",
    "organized skepticism",
    "particularism",
    "communality",
    "organized dogmatism",
    "self-interestedness",
    "universalism",
    "solitariness",
    "Comments"
  )

# Make new data frame with long and short names for reference
survey_qs <- tibble(q_long = names(survey), q_short = new_names)

# Swap out old (long) names for new (short) names
names(survey) <- new_names

survey_qs %>%
  kableExtra::kable(., format='html')
```
---

These data are 'wide', meaning that there are multiple variables for each respondent.
The data will be easier to visualize and analyze if we make the data 'longer'.

```{r}
survey_long <- survey %>%
  tidyr::pivot_longer(
    .,!c(
      'Timestamp',
      'Comments',
      'heardof_reproducibility_crisis',
      'my_area_reproducibility_crisis'
    ),
    names_to = "norm_counternorm",
    values_to = "rating"
  )
```

We should indicate whether these are norms, and label them "Norm", or counter-norms, and label them "Counternorm".

```{r}
survey_long <- survey_long %>%
  dplyr::mutate(., type = if_else(
    norm_counternorm %in% c(
      "disinterestedness",
      "organized skepticism",
      "communality",
      "universalism"
    ),
    "norm",
    "counternorm"
  ))
```

Finally, there is a "test" set of responses that I used to test this data processing workflow.
We should delete those responses since they are nonsensical--I just hit random buttons to make some data.

```{r}
survey_long_clean <- survey_long %>%
  dplyr::filter(., is.na(Comments)) %>%
  dplyr::filter(., !str_detect(Comments, "rog1"))
```

## Visualize data {-}

### Unique respondents {-}

There appear to be $n=$ `r length(unique(survey_long$Timestamp))` respondents as of `r Sys.time()`.

### Reproducibility crisis

> `r paste0("'", survey_qs$q_long[2], "?'")` 

```{r fig-heard-of-repro-crisis, fig.cap="Have you heard of the 'reproducibility crisis' in science?"}
survey %>%
  dplyr::filter(., !is.na(heardof_reproducibility_crisis)) %>%
  ggplot2::ggplot() +
  ggplot2::aes(heardof_reproducibility_crisis, fill = heardof_reproducibility_crisis) +
  ggplot2::geom_bar() +
  ggplot2::theme(legend.position = "none") +
  coord_flip()
```

> `r paste0("'", survey_qs$q_long[3], "?'")` 

```{r fig-repro-crisis-your-area, fig.cap="Is there a reproducibility crisis in your area of research?"}
survey %>%
  dplyr::mutate(., my_area_reproducibility_crisis = factor(
    my_area_reproducibility_crisis,
    c("Don't know", "No, there is no crisis", "Yes, a slight crisis", "Yes, a significant crisis")
  )) %>%
  dplyr::filter(., !is.na(my_area_reproducibility_crisis)) %>%
  ggplot2::ggplot() +
  ggplot2::aes(my_area_reproducibility_crisis, fill = my_area_reproducibility_crisis) +
  ggplot2::geom_bar()+
  ggplot2::theme(legend.position = "none") +
  coord_flip()
```

### Norm/Counternorm Rating distribution {-}

Remember, the rating scale was from 1: "not at all" to 5: "a great deal".

```{r fig-survey-responses, out.width="100%"}
survey_long %>% 
  ggplot() + 
  aes(norm_counternorm, rating, fill = type) + 
  geom_violin() +
  geom_point(position = position_jitter(width = .07, height = .07), alpha = 0.5) +
  coord_flip() +
  ggtitle("Ratings of scientists' adherence to norms and counternorms") +
  theme(legend.position = "bottom") +
  theme(legend.title = element_blank())
```

```{r fig-survey-norm-counter, out.width="100%"}
survey_long %>% 
  ggplot() + 
  aes(type, rating, fill = type) + 
  geom_violin() +
  geom_point(position = position_jitter(width = .07, height = .07), alpha = 0.5)
```

## References

